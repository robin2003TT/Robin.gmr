<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Food Catch Game</title>
    <link rel="stylesheet" href="style.css">
</head>
<body>
    <h1>Catch the Food!</h1>

    <!-- Leaderboard -->
    <div id="leaderboard">
        <h2>Leaderboard</h2>
        <div id="leaderboard-list"></div>
    </div>

    <!-- Game Container -->
    <div id="game-container">
        <div id="player">ü§§</div>
    </div>

    <!-- Controls -->
    <button id="leftBtn">‚óÄÔ∏è</button>
    <button id="rightBtn">‚ñ∂Ô∏è</button>

    <div id="score-container">
        <p>Score: <span id="score">0</span></p>
        <p>Lives: <span id="lives">‚ù§Ô∏è‚ù§Ô∏è‚ù§Ô∏è</span></p>
    </div>

    <!-- Background Music -->
    <audio id="bg-music" autoplay loop>
        <source id="audio-source" src="BUSSIN'.mp3" type="audio/mpeg">
    </audio>

    <button id="backBtn" onclick="goBack()">üîô Back</button>

    <script>
        // Game Variables
        let player = document.getElementById("player");
        let gameContainer = document.getElementById("game-container");
        let scoreDisplay = document.getElementById("score");
        let livesDisplay = document.getElementById("lives");
        let leaderboardList = document.getElementById("leaderboard-list");

        let playerPosition = 50;
        let score = 0;
        let lives = 3;

        // Ask for player name only once
        let playerName = sessionStorage.getItem("playerName");
        if (!playerName) {
            playerName = prompt("Enter your name:");
            sessionStorage.setItem("playerName", playerName);
        }

        let goodItems = ["üçì", "üçí", "üçé", "üçâ", "üçë", "üçä", "ü•≠", "üçç", "üçå", "üçã", "üçè", "üçê", "ü•ù", "ü´ê", "üçá", "üçî", "üçü", "üçï", "üç©", "üç´", "üç∞"];
        let badItems = ["üòà", "üëø", "üëª", "üíÄ", "‚ò†Ô∏è", "üí©", "üî•", "ü¶†", "üêõ", "ü™±", "üï∑Ô∏è", "ü¶ü", "üêå"];

        function movePlayer(direction) {
            if (direction === "left" && playerPosition > 0) {
                playerPosition -= 10;
            } else if (direction === "right" && playerPosition < 90) {
                playerPosition += 10;
            }
            player.style.left = playerPosition + "%";
        }

        document.getElementById("leftBtn").addEventListener("click", () => movePlayer("left"));
        document.getElementById("rightBtn").addEventListener("click", () => movePlayer("right"));

        function spawnItem() {
            let item = document.createElement("div");
            item.classList.add("falling-item");

            let isGood = Math.random() < 0.8;
            item.textContent = isGood ? goodItems[Math.floor(Math.random() * goodItems.length)] : badItems[Math.floor(Math.random() * badItems.length)];
            item.dataset.type = isGood ? "good" : "bad";

            // Prevent overlap by ensuring a minimum distance between falling items
            let newPosition;
            do {
                newPosition = Math.random() * 90;
            } while (document.querySelectorAll(".falling-item").some(existing => Math.abs(parseFloat(existing.style.left) - newPosition) < 5));
            
            item.style.left = newPosition + "%";
            gameContainer.appendChild(item);

            let fallInterval = setInterval(() => {
                let itemRect = item.getBoundingClientRect();
                let playerRect = player.getBoundingClientRect();

                if (itemRect.top > window.innerHeight) {
                    clearInterval(fallInterval);
                    item.remove();
                }

                if (
                    itemRect.bottom >= playerRect.top &&
                    itemRect.left < playerRect.right &&
                    itemRect.right > playerRect.left
                ) {
                    clearInterval(fallInterval);
                    item.remove();

                    if (item.dataset.type === "good") {
                        score++;
                        if (score % 100 === 0) {
                            alert(`Level Up! You're now at Level ${score / 100}`);
                        }
                    } else {
                        lives--;
                        if (lives <= 0) {
                            alert("Game Over! Your score: " + score);
                            updateLeaderboard();
                            resetGame();
                        }
                    }

                    updateUI();
                }
            }, 50);
        }

        function updateUI() {
            scoreDisplay.textContent = score;
            livesDisplay.innerHTML = "‚ù§Ô∏è".repeat(lives);
        }

        function updateLeaderboard() {
            let leaderboard = JSON.parse(localStorage.getItem("leaderboard")) || [];
            leaderboard.push({ name: playerName, score: score, level: Math.floor(score / 100) });
            leaderboard.sort((a, b) => b.score - a.score);
            localStorage.setItem("leaderboard", JSON.stringify(leaderboard));

            leaderboardList.innerHTML = leaderboard.map(entry => `<div class="leaderboard-item">${entry.name}: ${entry.score} (Level ${entry.level})</div>`).join("");
        }

        function resetGame() {
            score = 0;
            lives = 3;
            updateUI();
        }

        setInterval(spawnItem, 1000);

        // Music System
        let music = document.getElementById("bg-music");
        let audioSource = document.getElementById("audio-source");

        function goBack() {
            sessionStorage.setItem("musicTime", music.currentTime);
            window.location.href = "index.html";
        }

        window.onload = function () {
            if (sessionStorage.getItem("musicTime")) {
                music.currentTime = sessionStorage.getItem("musicTime");
                music.play();
            }
        };
    </script>
</body>
</html>
